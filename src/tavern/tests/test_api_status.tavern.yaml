test_name: Test API health

strict: False

stages:
  - name: Get API status
    request:
      url: "{tavern.env_vars.PROJECT_API_HOST}/status/?format=json"
      verify: false
      method: GET
    response:
      status_code: 200
      json:
        Database: working
        Cache: working
        Storage: working
        TaskProcessing: working

  - name: Get API subset status
    request:
      url: "{tavern.env_vars.PROJECT_API_HOST}/status/cache/?format=json"
      verify: false
      method: GET
    response:
      status_code: 200
      json:
        Cache: working

  - name: Get API info
    request:
      url: "{tavern.env_vars.PROJECT_API_HOST}/info/"
      verify: false
      method: GET
    response:
      status_code: 200
      json:
        name: Helium
        tagline: Student Planner & Academic Calendar App
        support_email: "{contact_email:s}"
        max_upload_size: 10485760

  - name: Check API handles not found
    request:
      url: "{tavern.env_vars.PROJECT_API_HOST}/a-fake-route"
      verify: false
      method: GET
    response:
      status_code: 404
